(()=>{"use strict";function t(t,e,o){document.addEventListener(t,(t=>{t.target.matches(e)&&o(t)}))}class e{constructor(t,e,o){this.name=t,this.dueDate=e,this.isComplete=!1,this.id=o||q()}}class o{constructor(t,e){this.name=t,this.color=e,this.id=q(),this.todoList=[]}}const n="todoList.projects",c="todoList.selectedProjectId";function r(){if(n,localStorage.getItem("todoList.projects"))return JSON.parse(localStorage.getItem(n));{const t=[],n=function(){const t=new o("Default","grey");return[new e("Brush Teeth","Jan 22 3:30 PM","defaultTodo1"),new e("Make Breakfast","Today 12:00 PM","defaultTodo2"),new e("Study","Tomorrow 9:00 PM","defaultTodo3")].forEach((e=>{t.todoList.push(e)})),t}();return t.push(n),d(t),u(n.id),t}}function a(t,e,o){let n=r();n.forEach((n=>{n.id===e&&n.todoList.forEach((e=>{e.id===t&&function(t,e){for(const o in e)t.hasOwnProperty(o)&&(t[o]=e[o])}(e,o)}))})),d(n)}function d(t){localStorage.setItem(n,JSON.stringify(t))}function i(){return localStorage.getItem(c)}function u(t){localStorage.setItem(c,t)}const l={project:document.querySelector('[data-template="project"'),projectView:document.querySelector('[data-template="project-view"]'),todo:document.querySelector('[data-template="todo"]')};function s(t){if(null!=t)return document.importNode(t.content,!0)}const m="project-row-btn--highlight";function p(){null!=C.sideMenu&&(window.matchMedia("(min-width: 768px)").matches?(C.body.classList.toggle("desktop-open"),C.sideMenu.classList.remove("mobile-open")):(C.body.classList.contains("desktop-open")||C.body.classList.add("desktop-open"),C.sideMenu.classList.toggle("mobile-open")))}function f(){document.querySelectorAll(".modal--active").forEach((t=>{I(t)})),w()}function h(t){I(t),w()}function y(){const t=document.createDocumentFragment();r().forEach((e=>{const o=function(t){const e=s(l.project),o=e.querySelector(".project-name"),n=e.querySelector(".project-color"),c=e.querySelector(".todo-count");return e.querySelector(".project").dataset.projectId=t.id,o.textContent=t.name,c.textContent=L(t),n.style.color=t.color,t.id===i()&&S(e.querySelector('[data-btn="show-project-view"]')),e}(e);t.appendChild(o)})),b(C.projectsContainer),C.projectsContainer.appendChild(t)}function g(t){if(null==t)return;const e=function(t){const e=s(l.projectView),o=e.querySelector(".project-view"),n=e.querySelector(".project-name"),c=e.querySelector('[data-container="todo-container"]');return o.dataset.projectId=t.id,n.textContent=t.name,t.todoList.forEach((t=>{const e=function(t){const e=s(l.todo),o=e.querySelector(".todo"),n=e.querySelector('[data-checkbox="todo"]'),c=e.querySelector('[data-label="todo-checkbox"]'),r=e.querySelector(".todo-name"),a=e.querySelector(".todo-due-date");return o.dataset.todoId=t.id,n.id=`todo-checkbox-${t.id}`,n.checked=!!t.isComplete,c.setAttribute("for",`todo-checkbox-${t.id}`),r.textContent=t.name,a.textContent=t.dueDate,e}(t);c.appendChild(e)})),e}(t);j(),C.projectViewContainer.appendChild(e)}function j(){b(C.projectViewContainer)}function S(t){!function(){const t=document.querySelector(".project-row-btn--highlight");null!=t&&t.classList.remove(m)}(),t.classList.add(m)}function v(t){const e=document.querySelector(`[data-project-id="${t.id}"] [data-todo-count]`),o=L(t);e.textContent=o}const C={body:document.body,sideMenu:document.querySelector("[data-side-menu]"),overlay:document.getElementById("overlay"),projectsContainer:document.getElementById("projects-container"),projectNameInput:document.getElementById("input-project-name"),projectColorInput:document.getElementById("input-project-color"),projectViewContainer:document.querySelector('[data-container="project-view"]'),todoNameInput:document.getElementById("input-todo-name"),todoDueDateInput:document.getElementById("input-todo-due-date")};function I(t){null!=t&&t.classList.remove("modal--active")}function w(){null!=C.overlay&&C.overlay.classList.remove("active")}function b(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function q(){return Date.now().toString()}function L(t){return t.todoList.filter((t=>!t.isComplete)).length||""}function k(t){t.preventDefault();const e=t.target,n={name:C.projectNameInput.value,color:C.projectColorInput.options[C.projectColorInput.selectedIndex].dataset.cssColor};if(!function(t){return B(t.name)}(n))return;const c=function(t){const e={...t};return e.name=e.name.trim(),e}(n),a=new o(c.name,c.color);!function(t){const e=r();e.push(t),d(e)}(a),y(),D(a),e.reset(),h(e.closest(".modal"))}function E(t){return t.closest("[data-project-id]").dataset.projectId}function x(t){return r().filter((e=>e.id===t))[0]}function D(t){u(t.id),S(function(t){return document.querySelector(`li[data-project-id="${t.id}"]`)}(t)),g(t)}function M(t){t.preventDefault();const o=t.target,n={name:C.todoNameInput.value,dueDate:C.todoDueDateInput.value};if(!function(t){return B(t.name)}(n))return;const c=function(t){const e={...t};return e.name=e.name.trim(),e}(n),a=i();!function(t,e){!function(t,e){const o=r();o.forEach((o=>{o.id===e&&o.todoList.push(t)})),d(o)}(t,e);const o=x(e);g(o),v(o)}(new e(c.name,c.dueDate),a),o.reset(),h(o.closest(".modal"))}function B(t){return null!=t&&""!==t.trim()}function N(t){return t.closest("[data-todo-id]").dataset.todoId}function T(t){const e=t.target,o=E(e),n=N(e);e.checked?a(n,o,{isComplete:!0}):a(n,o,{isComplete:!1}),v(x(o))}y(),g(x(i())),t("click","[data-header-toggle]",p),t("click","[data-modal-target]",(t=>{(function(t){null!=t&&t.classList.add("modal--active")})(document.querySelector(t.target.dataset.modalTarget)),null!=C.overlay&&C.overlay.classList.add("active")})),t("click","#overlay",f),t("click",'[data-btn="close-modal"]',(t=>{h(t.target.closest(".modal"))})),t("submit",'[data-form="create-project"]',k),t("submit",'[data-form="create-todo"]',M),t("click",'[data-btn="show-project-view"]',(t=>{const e=E(t.target);e!==i()&&D(x(e))})),t("click",'[data-btn="delete-project"]',(t=>{const e=E(t.target);!function(t){let e=r();e=e.filter((e=>e.id!==t)),d(e)}(e),y(),e===i()&&(localStorage.removeItem(c),j())})),t("click",'[data-btn="delete-todo"]',(t=>{const e=E(t.target);!function(t,e){!function(t,e){const o=r();o.forEach((o=>{o.id===e&&(o.todoList=o.todoList.filter((e=>e.id!==t)))})),d(o)}(t,e);const o=x(e);g(o),v(o)}(N(t.target),e)})),t("change",'[data-checkbox="todo"]',T)})();