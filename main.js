(()=>{"use strict";function t(t,e,o){document.addEventListener(t,(t=>{t.target.matches(e)&&o(t)}))}class e{constructor(t,e,o){this.name=t,this.dueDate=e,this.isComplete=!1,this.id=o||k()}}class o{constructor(t,e){this.name=t,this.color=e,this.id=k(),this.todoList=[]}}const n="todoList.projects",c="todoList.selectedProjectId";function r(){if(n,localStorage.getItem("todoList.projects"))return JSON.parse(localStorage.getItem(n));{const t=[],n=function(){const t=new o("Default","grey");return[new e("Brush Teeth","2022-01-02","defaultTodo1"),new e("Make Breakfast","","defaultTodo2"),new e("Study","2021-12-01","defaultTodo3")].forEach((e=>{t.todoList.push(e)})),t}();return t.push(n),a(t),u(n.id),t}}function d(t,e,o){let n=r();n.forEach((n=>{n.id===e&&n.todoList.forEach((e=>{e.id===t&&function(t,e){for(const o in e)t.hasOwnProperty(o)&&(t[o]=e[o])}(e,o)}))})),a(n)}function a(t){localStorage.setItem(n,JSON.stringify(t))}function i(){return localStorage.getItem(c)}function u(t){localStorage.setItem(c,t)}const l={project:document.querySelector('[data-template="project"'),projectView:document.querySelector('[data-template="project-view"]'),todo:document.querySelector('[data-template="todo"]'),todoModal:document.querySelector('[data-template="modal-todo"]')};function s(t){if(null!=t)return document.importNode(t.content,!0)}function m(t,e,o,n,c,r){const d=s(l.todoModal),a=d.querySelector(".modal"),i=d.querySelector(".modal__title"),u=d.querySelector("form"),m=u.querySelector('[data-label="todo-name"]'),p=u.querySelector('[data-input="todo-name"]'),f=u.querySelector('[data-label="todo-due-date"]'),y=u.querySelector('[data-input="todo-due-date"]'),h=u.querySelector('[type="submit"]');return a.id=t,p.id=n,y.id=c,u.dataset.form=o,m.setAttribute("for",n),f.setAttribute("for",c),i.textContent=e,h.textContent=r,d}const p="project-row-btn--highlight";function f(){null!=C.sideMenu&&(window.matchMedia("(min-width: 768px)").matches?(C.body.classList.toggle("desktop-open"),C.sideMenu.classList.remove("mobile-open")):(C.body.classList.contains("desktop-open")||C.body.classList.add("desktop-open"),C.sideMenu.classList.toggle("mobile-open")))}function y(){document.querySelectorAll(".modal--active").forEach((t=>{w(t)})),L()}function h(t){w(t),L()}function S(){const t=document.createDocumentFragment();r().forEach((e=>{const o=function(t){const e=s(l.project),o=e.querySelector(".project-name"),n=e.querySelector(".project-color"),c=e.querySelector(".todo-count");return e.querySelector(".project").dataset.projectId=t.id,o.textContent=t.name,c.textContent=E(t),n.style.color=t.color,t.id===i()&&q(e.querySelector('[data-btn="show-project-view"]')),e}(e);t.appendChild(o)})),I(C.projectsContainer),C.projectsContainer.appendChild(t)}function g(t){if(null==t)return;const e=function(t){const e=s(l.projectView),o=e.querySelector(".project-view"),n=e.querySelector(".project-name"),c=e.querySelector('[data-container="todo-container"]');return o.dataset.projectId=t.id,n.textContent=t.name,t.todoList.forEach((t=>{const e=function(t){const e=s(l.todo),o=e.querySelector(".todo"),n=e.querySelector('[data-checkbox="todo"]'),c=e.querySelector('[data-label="todo-checkbox"]'),r=e.querySelector(".todo-name"),d=e.querySelector(".todo-due-date");return o.dataset.todoId=t.id,n.id=`todo-checkbox-${t.id}`,n.checked=!!t.isComplete,c.setAttribute("for",`todo-checkbox-${t.id}`),r.textContent=t.name,d.textContent=t.dueDate,e}(t);c.appendChild(e)})),e}(t);j(),C.projectViewContainer.appendChild(e)}function j(){I(C.projectViewContainer)}function q(t){!function(){const t=document.querySelector(".project-row-btn--highlight");null!=t&&t.classList.remove(p)}(),t.classList.add(p)}function v(t){const e=document.querySelector(`[data-project-id="${t.id}"] [data-todo-count]`),o=E(t);e.textContent=o}function b(t){return{name:t.querySelector('[data-input="todo-name"]').value,dueDate:t.querySelector('[data-input="todo-due-date"]').value}}const C={body:document.body,sideMenu:document.querySelector("[data-side-menu]"),overlay:document.getElementById("overlay"),projectsContainer:document.getElementById("projects-container"),projectNameInput:document.getElementById("input-project-name"),projectColorInput:document.getElementById("input-project-color"),projectViewContainer:document.querySelector('[data-container="project-view"]')};function w(t){null!=t&&t.classList.remove("modal--active")}function L(){null!=C.overlay&&C.overlay.classList.remove("active")}function I(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function k(){return Date.now().toString()}function E(t){return t.todoList.filter((t=>!t.isComplete)).length||""}function x(t){t.preventDefault();const e=t.target,n={name:C.projectNameInput.value,color:C.projectColorInput.options[C.projectColorInput.selectedIndex].dataset.cssColor};if(!function(t){return V(t.name)}(n))return;const c=function(t){const e={...t};return e.name=e.name.trim(),e}(n),d=new o(c.name,c.color);!function(t){const e=r();e.push(t),a(e)}(d),S(),T(d),e.reset(),h(e.closest(".modal"))}function D(t){return t.closest("[data-project-id]").dataset.projectId}function M(t){return r().filter((e=>e.id===t))[0]}function T(t){u(t.id),q(function(t){return document.querySelector(`li[data-project-id="${t.id}"]`)}(t)),g(t)}function A(t){t.preventDefault();const o=t.target,n=b(o);if(!N(n))return;const c=$(n),d=i(),u=new e(c.name,c.dueDate),l=o.closest(".modal");!function(t,e){!function(t,e){const o=r();o.forEach((o=>{o.id===e&&o.todoList.push(t)})),a(o)}(t,e);const o=M(e);g(o),v(o)}(u,d),o.reset(),h(l)}function B(t){t.preventDefault();const e=t.target,o=b(e);if(!N(o))return;const n=$(o),c=i(),r=O(e),a=e.closest(".modal");d(r,c,{name:n.name,dueDate:n.dueDate});const u=M(c);e.reset(),g(u),h(a)}function N(t){return V(t.name)}function V(t){return null!=t&&""!==t.trim()}function $(t){const e={...t};return e.name=e.name.trim(),e}function O(t){return t.closest("[data-todo-id]").dataset.todoId}function J(t){const e=t.target,o=D(e),n=O(e);e.checked?d(n,o,{isComplete:!0}):d(n,o,{isComplete:!1}),v(M(o))}(function(){const t=[],e=m("modal-add-todo","Add Todo","add-todo","input-add-todo-name","input-add-todo-due-date","Add"),o=m("modal-edit-todo","Edit Todo","edit-todo","input-edit-todo-name","input-edit-todo-due-date","Edit");return t.push(e,o),t})().forEach((t=>{C.body.append(t)})),S(),g(M(i())),t("click","[data-header-toggle]",f),t("click","[data-modal-target]",(t=>{const e=t.target,o=document.querySelector(e.dataset.modalTarget);var n,c;"edit-todo"===e.dataset.btn&&function(t,e){const o=e.querySelector("#input-edit-todo-name"),n=e.querySelector("#input-edit-todo-due-date");e.dataset.todoId=t.id,o.value=t.name,n.value=t.dueDate}((n=D(e),c=O(e),M(n).todoList.filter((t=>t.id===c))[0]),o),function(t){!function(t){null!=t&&t.classList.add("modal--active")}(t),null!=C.overlay&&C.overlay.classList.add("active")}(o)})),t("click","#overlay",y),t("click",'[data-btn="close-modal"]',(t=>{h(t.target.closest(".modal"))})),t("submit",'[data-form="create-project"]',x),t("submit",'[data-form="add-todo"]',A),t("submit",'[data-form="edit-todo"]',B),t("click",'[data-btn="show-project-view"]',(t=>{const e=D(t.target);e!==i()&&T(M(e))})),t("click",'[data-btn="delete-project"]',(t=>{const e=D(t.target);!function(t){let e=r();e=e.filter((e=>e.id!==t)),a(e)}(e),S(),e===i()&&(localStorage.removeItem(c),j())})),t("click",'[data-btn="delete-todo"]',(t=>{const e=D(t.target);!function(t,e){!function(t,e){const o=r();o.forEach((o=>{o.id===e&&(o.todoList=o.todoList.filter((e=>e.id!==t)))})),a(o)}(t,e);const o=M(e);g(o),v(o)}(O(t.target),e)})),t("change",'[data-checkbox="todo"]',J)})();